#textdomain wesnoth-Saga_of_James

[scenario]
  id=07_Return
  name=_"Return"
  next_scenario=08_Xxx
  map_data="{~add-ons/Saga_of_James/volume1/maps/07_Return.map}"
  turns=-1
  carryover_percentage=40
  carryover_add=yes
  {INTRO_AND_SCENARIO_MUSIC nunc_dimittis.ogg journeys_end.ogg}
  {EXTRA_SCENARIO_MUSIC the_deep_path.ogg}
  {EXTRA_SCENARIO_MUSIC transience.ogg}
  {STORY7}
  victory_when_enemies_defeated=no
  {DEFAULT_SCHEDULE}

  [side]
    side=1
    controller=human
    team_name=villagers
    user_team_name= _ "team_name^Villagers"

    type=Plain_Mage
    id=James
    name=_"James"
    gender=male
    canrecruit=yes
    unrenamable=yes

    {FLAG_VARIANT loyalist}
    recruit=Peasant,Woodsman

    {GOLD4 70 60 50 50}
    income=-2

    fog=yes
    shroud=no
  [/side]
  {STARTING_VILLAGES 1 4}

  [side]
    side=2
    controller=ai
    team_name=villagers
    user_team_name= _ "team_name^Villagers"

    type=Lieutenant
    id=Ligwyn
    name=_"Ligwyn"
    gender=male
    canrecruit=yes

    {FLAG_VARIANT loyalist}
    recruit=Spearman,Bowman,Poacher

    gold=1
    income=-2

    fog=yes
    shroud=no
    share_view=no
  [/side]
  {STARTING_VILLAGES 2 2}

  [side]
    side=3
    controller=ai
    team_name=undead
    user_team_name= _ "team_name^Undead"
    hidden=yes

    type=Death Baron
    id=DeathBaron
    canrecruit=yes

    {FLAG_VARIANT undead}
    recruit=Skeleton,Skeleton Archer,Skeleton Rider,Walking Corpse

    gold=1
    income=-2
  [/side]
  {STARTING_VILLAGES 3 4}

  [event]
    name=prestart
    {VARIABLE progress 1}
    {VARIABLE village_entered no}
    [objectives]
      side=1
      [objective]
        description= _ "Enter the village with a village hunter"
        condition=win
        [show_if]
          [variable]
            name=village_entered
            equals=no
          [/variable]
        [/show_if]
      [/objective]
      [objective]
        description= _ "Defeat all enemies"
        condition=win
        [show_if]
          [variable]
            name=progress
            equals=2
          [/variable]
          [have_unit]
            side=2
          [/have_unit]
        [/show_if]
      [/objective]
      [objective]
        description= _ "Death of James"
        condition=lose
        [show_if]
          [variable]
            name=progress
            equals=2
          [/variable]
        [/show_if]
      [/objective]
      [objective]
        description= _ "Death of Belinda"
        condition=lose
        [show_if]
          [variable]
            name=progress
            equals=2
          [/variable]
        [/show_if]
      [/objective]
      [objective]
        description= _ "Death of Edgar"
        condition=lose
        [show_if]
          [variable]
            name=progress
            equals=2
          [/variable]
        [/show_if]
      [/objective]
      [objective]
        description= _ "Death of any village hunter"
        condition=lose
        [show_if]
          [variable]
            name=progress
            equals=2
          [/variable]
        [/show_if]
      [/objective]
      {TURNS_RUN_OUT}
      [+objective]
        [show_if]
          [variable]
            name=progress
            equals=2
          [/variable]
        [/show_if]
      [/objective]
      [gold_carryover]
        bonus=yes
        carryover_percentage=40
      [/gold_carryover]
    [/objectives]
  [/event]

  [event]
    name=start
    {RECALL_SUPPORTER}
    {RECALL_HEROES}
    [recall]
      id=hunters_leader
    [/recall]
    [message]
      speaker=James
      message=_"Uh, uh. I could use a little break, I am not really used to long treks. ... Oh, it looks like it started to snow, I did not notice it."
    [/message]
    [message]
      speaker=Belinda
      message=_"Oh, you're right, I didn't notice either. And by the way, how long is it to your village, James?"
    [/message]
    [message]
      speaker=James
      message=_"Let me see ... well, we are quite close, we should reach it in less than two hours."
    [/message]
    [message]
      speaker=Belinda
      message=_"Good, good. And how are you feeling now, James? Can you continue?"
    [/message]
    [message]
      speaker=James
      message=_"Ah, yes, I feel better, thank you. Alright, let us go, everyone, we are almost there."
    [/message]
  [/event]

  [event]
    name=sighted
    [filter]
      side=3
    [/filter]
    [filter_second]
      side=1
    [/filter_second]
    {INCIDENTAL_MUSIC the_city_falls.ogg}
    {GENERIC_UNIT 2 Spearman 17 27}
    {GENERIC_UNIT 2 Spearman 18 26}
    {GENERIC_UNIT 2 Poacher 19 27}
    {GENERIC_UNIT 3 (Bone Knight) 16 15}
    {GENERIC_UNIT 3 Revenant 18 15}
    {GENERIC_UNIT 3 Revenant 16 16}
    {GENERIC_UNIT 3 Soulless 18 16}
    {GENERIC_UNIT 3 Soulless 17 17}
    [unit]
      side=1
      type=Warmaster
      x,y=17,28
      id=Edgar
      name= _ "Edgar"
      unrenamable=yes
      facing=nw
      [modifications]
        {TRAIT_LOYAL}
        {TRAIT_FEARLESS}
      [/modifications]
      {IS_LOYAL}
      {IS_HERO}
    [/unit]
    [if]
      [variable]
        name=second_unit.id
        equals=James
      [/variable]
      [then]
        [message]
          speaker=James
          message=_"Lords of Light, this cannot be happening. I do not believe my eyes."
        [/message]
        [message]
          speaker=Belinda
          message=_"What is wrong, James? ... Oh my, what are those things?"
        [/message]
      [/then]
      [else]
        [message]
          speaker=second_unit
          message=_"Lords of Light, what is going on here?"
        [/message]
      [/else]
    [/if]
    [scroll_to_unit]
      id=DeathBaron
    [/scroll_to_unit]
    [delay]
      time=500
    [/delay]
    [message]
      speaker=James
      message=_"This is our village's graveyard and it looks like our dead starting to come out of their graves. It has to be work of a necromancer but why would they be interested in our little village?"
    [/message]
    [scroll_to_unit]
      id=Ligwyn
    [/scroll_to_unit]
    [delay]
      time=100
    [/delay]
    [modify_side]
      side=2
      {GOLD4 90 75 60 0}
      {INCOME4 1 -1 -1 -1}
      share_view=yes
    [/modify_side]
    [modify_side]
      side=3
      hidden=no
      {GOLD4 130 150 170 170}
      {INCOME4 -1 0 1 1}
    [/modify_side]
    [message]
      speaker=Ligwyn
      message=_"What's that, next undead? ... Oh, it's you, James. What took you so long? Well, I guess I can hear that later. For now, we need your help once again. You see, our dead have rised from their graves, we need to put them back. Will you help us, please?"
    [/message]
    [message]
      speaker=James
      message=_"Of course, Captain. Actually, my magic could be put to good use here."
    [/message]
    [scroll_to_unit]
      id=Edgar
    [/scroll_to_unit]
    [delay]
      time=500
    [/delay]
    [message]
      speaker=James
      message=_"Oh, hail, Edgar. I see that you are still here."
    [/message]
    [message]
      speaker=Edgar
      message=_"Hi, brother. Of course I'm here. My home village is under attack and I'm a soldier. Where else should I be?"
    [/message]
    [message]
      speaker=James
      message=_"Sure, sure, I was just surprised to see you."
    [/message]
    [message]
      speaker=Edgar
      message=_"Oh and I see you've brought a lady friend with you. What is her name?"
    [/message]
    [message]
      speaker=James
      message=_"It is Belinda, Edgar. Belinda, this is my elder brother Edgar."
    [/message]
    [message]
      speaker=Belinda
      message=_"Nice to meet you, Edgar."
    [/message]
    [message]
      speaker=Edgar
      message=_"Pleased to meet you too. Maybe we could ..."
    [/message]
    [message]
      speaker=Belinda
      message=_"Get back to the battle? Of course."
    [/message]
    [message]
      speaker=Edgar
      message=_"That's not what I meant but sure. Let's fight these undead."
    [/message]
    {VARIABLE progress 2}
    [show_objectives]
    [/show_objectives]
    {REPLACE_SCENARIO_MUSIC battle.ogg}
    {APPEND_MUSIC frantic.ogg}
    {APPEND_MUSIC siege_of_laurelmor.ogg}
    {APPEND_MUSIC into_the_shadows.ogg}
  [/event]

  [event]
    name=moveto
    [filter]
      side=1
      [filter_wml]
        [variables]
          village_hunter=yes
        [/variables]
      [/filter_wml]
      x=12-20,14-20,16-20,18-20,20
      y=24-35,23,22,21,20
    [/filter]
    {VARIABLE village_entered yes}
    [if]
      [have_unit]
        side=3
        count=0
      [/have_unit]
      [then]
        [endlevel]
          result=victory
        [/endlevel]
      [/then]
      [else]
        [show_objectives]
        [/show_objectives]
      [/else]
    [/if]
  [/event]

  [event]
    name=die
    first_time_only=no
    [filter]
      side=3
    [/filter]
    [if]
      [have_unit]
        side=3
        count=0
      [/have_unit]
      [variable]
        name=village_entered
        equals=yes
      [/variable]
      [then]
        [endlevel]
          result=victory
        [/endlevel]
      [/then]
    [/if]
  [/event]

  [event]
    name=victory
    [kill]
      side=1
      [filter_wml]
        [variables]
          village_hunter=yes
        [/variables]
      [/filter_wml]
      animate=no
      fire_event=no
    [/kill]
    [kill]
      id=Edgar
      animate=no
      fire_event=no
    [/kill]
    {CLEAR_VARIABLE progress,village_entered}
  [/event]

  [event]
    name=last breath
    [filter]
      id=James
    [/filter]
    [message]
      speaker=unit
      message=_"Farewell, the world."
    [/message]
    [message]
      speaker=Belinda
      message=_"James, no! I think ... I'll miss you."
    [/message]
    {DEFEAT}
  [/event]

  [event]
    name=die
    [filter]
      id=Ligwyn
    [/filter]
    [message]
      speaker=James
      message=_"Without the Captain, we all are as good as dead."
    [/message]
    {DEFEAT}
  [/event]

  [event]
    name=last breath
    [filter]
      id=Edgar
    [/filter]
    [message]
      speaker=unit
      message=_"So this is the end of my journey. I hope you you'll take care of this undead menace, brother."
    [/message]
    [message]
      speaker=James
      message=_"No, Edgar, do not die! I cannot continue without you."
    [/message]
    {DEFEAT}
  [/event]

  {BELINDAS_DEATH1}
  {SUPPORTERS_DEATH}
  {HUNTERS_DEATH}
[/scenario]
